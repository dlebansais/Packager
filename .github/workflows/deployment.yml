name: Deployment

# Triggered manually
on: workflow_dispatch

jobs:
  # This workflow contains a single job called "deploy"
  deploy:
    runs-on: windows-latest
    
    steps:
      - name: Configure Git
        run: |
          git config --global user.name ${GITHUB_ACTOR}
          git config --global user.email ${GITHUB_ACTOR}@githubaction.io
          
      # Checks-out master (to be able to merge it)
      - uses: actions/checkout@v2
        with:
          ref: 'master'

      - name: Update master
        run: git pull

      # Checks-out deployment
      - uses: actions/checkout@v2
        with:
          ref: 'deployment'

      - name: Update deployment
        run: git pull

      - name: Execute deployment
        run: |
          [xml]$xml = Get-Content .\Packager\Packager.csproj
          $version = $xml.Project.PropertyGroup.Version
          set VERSION v$version
          echo "Deploying $VERSION ..."
          git merge origin/master -m "$VERSION"
          git push
